---
layout: post
title:  "2020-10-27-Java对象的内存布局"
date:   2020-10-27 21:03:36 +0530
categories: Web
tags: [java, web]
description: 在HotSpot虚拟机里，对象在堆内存中的存储布局可以划分为三个部分：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。
---

在HotSpot虚拟机里，对象在堆内存中的存储布局可以划分为三个部分：对象头、实例数据、和对齐填充。

由于HotSpot虚拟机的自动内存管理要求对象的起始地址必须是8字节的整数倍，因此对象的大小都必须是8字节的整数倍。如果对象的实例数据部分没有对齐8字节的话，需要占位符补全8个字节。

在《Java虚拟机规范》中约定堆上的数据对象是由栈上的引用（Reference）来定位的，一般有两种方式：
1. 使用句柄方式，Java堆中会划分出一块内存作为句柄池，栈的引用存放句柄池中句柄的地址，这样访问一个具体的对象需要经过间接访问
2. 使用直接地址，栈的引用存放对象地址，不需要多一次间接访问的开销

虚拟机在垃圾回收时常常需要移动堆内对象的地址，因此句柄方式的最大优势在于稳定的引用地址，只需要变更句柄池中的引用地址即可。

使用直接地址的最大优势在于更快的访问速度，因此Hotspot采用直接地址的方式实现对内对象的引用。
